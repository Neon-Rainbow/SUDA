# 习题11

## 1

> 目录文件采用链接式，每个磁盘块存放 10 个下级文件的描述，最多存放 40 个下级文件，若下级文件为目录文件，上级目录指向该目录文件的第一块，否则指向普通文件的文件控制块。普通文件采用二级索引形式，文件控制块中给出 12 个磁盘块地址，前 10个磁盘块地址指出前 10 页的物理地址，第 11 个磁盘块地址指向一级索引表，一级索引表给出 256 个磁盘块地址，即指出该文件第 10 页至第 265 页的地址，第 12 个磁盘块地址指向二级索引表，二级索引表中指出 256 个一级索引表的地址。
> 1.   该文件系统中的普通文件最大可有多少页？
> 2.   若要读文件/A/D/K/Q 中的某一页，最少要启动磁盘几次？最多要启动磁盘几次？（每读一个磁盘块需要启动一次磁盘操作）

### 1

$10 + 256 + 256^2 = 65802$

### 2

最少:1次

最多:3次

## 2

>   一个文件有 20 个磁盘块（块号： 0-19），假设文件控制块在内存（如果文件采用索引分配，索引表不在内存）。在下列情况下，请计算在连续分配，链接分配，单级索引分配三种分配方式下，分别需要多少次磁盘 I/O 操作？（每读入或写出一个磁盘块需要一次磁盘 I/O 操作，另外，假设在连续分配方式下，文件头部无空闲的磁盘块，但文件尾部有空闲的磁盘块。
>   1.   在文件开始处删除一个磁盘块；
>   2.   在文件第 15 块前添加一个磁盘块并写入内容；
>   3.   在文件结尾处删除一个磁盘块；
>   4.   在文件结尾处增加一个磁盘块并写入内容。

连续分配:

1.   38次
2.   11次
3.   0次
4.   1次



链接分配:

1.   2次
2.   17次
3.   20次
4.   20次



单级索引分配:

1.   2次
2.   3次
3.   2次
4.   3次

## 3

>   设想一个在磁盘上的文件系统的逻辑块和物理块的大小都为 512B。假设每个文件的FCB已经在内存中，对 3 种分配方法（连续分配，显式链接分配和单级索引分配），请问：
>   1.   逻辑地址到物理地址的映射在系统中如何实现？
>   2.   举一个例子说明单级索引分配中，逻辑地址到物理地址的映射过程。

### 1

1.   **连续分配**：在这种方法中，每个文件都占用一个连续的磁盘空间。文件的起始块号和文件长度（以块为单位）存储在文件的FCB中。逻辑地址（逻辑块号）到物理地址（物理块号）的映射通过将逻辑块号加到起始块号上来实现。
2.   **显式链接分配**：在这种方法中，文件是由许多不连续的磁盘块组成的，这些磁盘块通过链接（指针）连接在一起。每个磁盘块都包含一个指向文件下一个块的指针。因此，逻辑块号到物理块号的映射需要遍历文件的块链。
3.   **单级索引分配**：在这种方法中，文件的FCB包含一个索引块，索引块中的每个条目都指向文件的一个磁盘块。因此，逻辑块号到物理块号的映射可以通过直接索引索引块来实现。

### 2

每个文件都有对应的索引表,索引表是一个磁盘块地址的目录.索引块的第$i$个条目指向文件的第$i$个块.要读取第$i$个块的物理地址,通过索引表的第$i$个条目的指针来查找.



## 4

>    请举一个具体文件系统的例子，来说明文件系统一般由哪些内容组成？

UFS:

1.  **超级块**：这是文件系统的元信息，包含了文件系统的重要参数，如 inode 数量，数据块数量，空闲 inode 和数据块的数量等。
2.  **inode 列表**：每个文件或目录在文件系统中都有一个唯一的 inode。inode 包含了文件的元数据，如文件类型（普通文件，目录，符号链接等），权限，所有者，大小，创建时间，修改时间，数据块指针等。
3.  **数据块**：这是存储文件数据的地方。每个数据块的大小通常是固定的，如 1KB，4KB 等。
4.  **目录**：目录是一种特殊的文件，它包含了一组文件名和对应 inode 号的映射。这样，当我们需要访问一个文件时，可以通过目录找到文件名对应的 inode，然后通过 inode 找到文件数据。
5.  **空闲块和空闲 inode 列表**：文件系统需要跟踪哪些数据块和 inode 是空闲的，以便在创建新文件或增加文件大小时使用。

