define("sjs/matrix/ad/form/commonspe",["sjs/flash/swfobject","sjs/data/cookie","sjs/matrix/ad/statspe"],function(swfobject,cookie,stat){var document=window.document,navigator=window.navigator,location=window.location,$=jQuery;var config=$.extend({FLASH_PLAYER:"http://images.sohu.com/bill/s2013/gates/all/final130402-4.swf",FLASH_COVER:"http://images.sohu.com/bill/default/1x1.gif"},window["passion_config"]);var Common=function(adObj){this.adObject=adObj;this.container=$("#"+adObj.cont_id);this.options=$.extend({},this.options,adObj.spec)};var CP={init:function(){var res=this.adObject.resource;res.itemspaceid=this.adObject.cont_id;this.insert();if(("image, flash, text, html, iframe").indexOf(res.type)!==-1){this.adObject.trigger("afterload")}},attach:function(){},insert:function(resource){var pageUrl=window.location.href.split("://")[0];var adObj=this.adObject;var res=resource||adObj.resource;if(!!res){if(pageUrl=="http"){res.file="http://"+res.file.split("://")[1]}else if(pageUrl=="https"){res.file="https://"+res.file.split("://")[1]}}if(!res||!res.type)return;var type="insert"+res.type.replace(/\s[a-z]/g,function($1){return $1.toLocaleUpperCase()}).replace(/^[a-z]/,function($1){return $1.toLocaleUpperCase()});if(!res.cont_id){res.cont_id=this.adObject.cont_id}if(type in this){this[type].call(this,res);adObj.trigger("afterload_res",res)}},insertImage:function(options){if(!options.cont_id)return;return $('#'+options.cont_id).html('<img src="'+options.file+'" border="0"'+' style = "width:'+options.width+'px; '+'height:'+options.height+'px"/>')},insertMp4:function(options){return $('#'+options.cont_id).html("<video id='video_page' preload='auto' muted width='"+options.width+"' height='"+options.height+"' autoplay='autoplay' loop='loop'><source src='"+options.file+"' />Your browser does not support the video tag.</video>")},insertIframe:function(options){if(!options.cont_id)return;return $('#'+options.cont_id).html('<iframe width="'+options.width+'" height="'+options.height+'" frameborder="0" marginwidth="0" marginheight="0" scrolling="no" src="'+options.file+'"></iframe>')},insertFlash:function(options){if(!options.cont_id)return;var cont_id=options.cont_id+"_flash";var opt=$.extend({swfVersionStr:"10.1",xiSwfUrlStr:"",flashvarsObj:{},parObj:{"wmode":"transparent",allowScriptAccess:"always"},attObj:{"wmode":"transparent",allowScriptAccess:"always"}},options);opt.attObj.data=opt.file;opt.attObj.id=cont_id;opt.attObj.width=opt.width;opt.attObj.height=opt.height;opt.parObj.flashvars=opt.attObj.flashvars=$.param(opt.flashvarsObj);if(!!!this.adObject["isnot_flashcover"]){var _lmth="<div style=\"position:relative;width:"+opt.width+"px;height:"+opt.height+"px;margin:0 auto;\">"+"<div style=\"position:absolute;z-index:1;width:"+opt.width+"px;height:"+opt.height+"px;top:0px;left:0px;\">"+"<div id=\""+cont_id+"\"></div>"+"</div>"+"</div>"}else{var _lmth="<div id=\""+cont_id+"\" style=\"width:"+opt.width+"px;height:"+opt.height+"px;\"></div>"}$('#'+opt.cont_id).html(_lmth);return swfobject&&swfobject.createSWF(opt.attObj,opt.parObj,cont_id)},insertText:function(options){if(!options.cont_id)return;return $('#'+options.cont_id).html('<a href="'+options.click+'" target="_blank">'+options.text+'</a>')},insertHtml:function(options){if(!options.cont_id)return;return $('#'+options.cont_id).html(options.html)},insertScript:function(options){var self=this;var opt=options||this.options;if(opt["is_ready"])return;$.getScript(opt.file,function(){if(opt.onload){if(typeof(opt.onload)==="function"){opt.onload.call(self.adObject)}else{var funname="fun"+(new Date().getTime());window.eval("window."+funname+" = "+options.onload);window[funname].apply(self.adObject);window[funname]=undefined}}})},show:function(){this.container.show();this.container.trigger("aftershow")},hide:function(){this.container.hide();this.container.trigger("afterhide")},detach:function(){this.container.detach()},loadThirdCode:function(thirdUrl,adobj){var adobj=adobj;var self=this;var right_width;window['SOHU_AD_PV']=function(PARA_SOHU_PV){adobj.cx="";adobj.cy="";adobj.x=PARA_SOHU_PV.x;adobj.y=PARA_SOHU_PV.y;stat.get("pv",adobj);stat.ad_plus_pv(adobj)};window['SOHU_AD_AV']=function(PARA_SOHU_AV){adobj.cx="";adobj.cy="";adobj.x=PARA_SOHU_AV.x;adobj.y=PARA_SOHU_AV.y;stat.get("av",adobj)};window['SOHU_AD_CUBE']=function(PARA_SOHU_THIRD){adobj.cx=PARA_SOHU_THIRD.cx;adobj.cy=PARA_SOHU_THIRD.cy;stat.get("click",adobj);self.postAdplus(adobj)};jQuery.ajax({url:thirdUrl,dataType:"script",async:false,success:function(){},error:function(XMLHttpRequest,textStatus,errorThrown){console.info(XMLHttpRequest.status);console.info(XMLHttpRequest.readyState);console.info(textStatus)}})},addDivClick:function(){var self=this;var adObj=self.adObject;jQuery("<div id='"+adObj.cont_id+"_Click'></div>").css({"width":adObj.resource.width,"height":adObj.resource.height,"cursor":"pointer","position":"absolute","top":0,"z-index":2}).appendTo(jQuery("#"+adObj.cont_id));if(self.checkIE()){jQuery("#"+adObj.cont_id+"_Click").css({'background-color':'red','filter':'alpha(opacity=0)'})}jQuery("#"+adObj.cont_id+"_Click").bind("click",function(evt){self.postAdplus(adObj);self.adObject.cx=evt.clientX;self.adObject.cy=evt.clientY;stat.get("click",adObj)})},addDivClick2:function(id,resource){var self=this;var adObj=self.adObject;jQuery("<div id='"+adObj.cont_id+"_Click_"+id+"'></div>").css({"width":resource.width,"height":resource.height,"cursor":"pointer","position":"absolute","top":0,"z-index":2}).appendTo(jQuery("#"+id));if(self.checkIE()){jQuery("#"+adObj.cont_id+"_Click_"+id).css({'background-color':'red','filter':'alpha(opacity=0)'})}jQuery("#"+adObj.cont_id+"_Click_"+id).bind("click",function(evt){self.postAdplus(adObj);self.adObject.cx=evt.clientX;self.adObject.cy=evt.clientY;stat.get("click",adObj)})},addMonitorkey:function(){jQuery("<div id='"+this.adObject.monitorkey+"' style='display:none;'>").appendTo(jQuery("#"+this.adObject.cont_id))},addCloseButton:function(adObj){if(adObj){var adObj=adObj}else{var adObj=this.adObject}var close_button=jQuery("<div id='"+adObj.cont_id+"_close'></div>").css({"width":"93px","height":"28px","background":"url('http://images.sohu.com/bill/s2015/jscript/lib/sjs/matrix/html/close.png')","position":"absolute","z-index":3,"color":"white","right":35,"top":"0px","cursor":"pointer"}).appendTo(jQuery("#"+adObj.cont_id));close_button.bind("click",function(){jQuery("#"+adObj.cont_id).remove()})},addAdFlag:function(adObj){if(!!document.getElementById('ad-flag_'+adObj.cont_id)){return}var adflag=$("<div id='ad-flag_"+adObj.cont_id+"'></div>").css({"position":"absolute","top":"0px","height":"16px","color":"white","opacity":"0.6","filter":"alpha(opacity=0.6)","z-index":3,"cursor":"auto","background-color":"rgb(93, 89, 89)"}).appendTo($("#"+adObj.cont_id));if(!!adObj.dsp_source&&this.getRealLength(adObj.dsp_source)<=4){jQuery("<p>"+adObj.dsp_source+"|\u5e7f\u544a"+"</p>").css({"padding":"0 0px"}).appendTo(jQuery("#ad-flag_"+adObj.cont_id))}else{jQuery("<p>\u5e7f\u544a</p>").css({"padding":"0 0px"}).appendTo(jQuery("#ad-flag_"+adObj.cont_id))}jQuery("#"+adObj.cont_id).bind("mouseover",function(){jQuery("#ad-flag_float p").css({"color":"white"})});if(this.checkIE()){jQuery("#ad-flag_"+adObj.cont_id).css({"filter":"alpha(opacity=60)"})}jQuery('<a href="http://www.iac-i.org/privacy/" target="_blank" class="got-i-icon" style="z-index:2147483648;"></a>').appendTo($("#"+adObj.cont_id))},getRealLength:function(str){var length=str.length;var realLength=0;var temLength=0;for(var i=0;i<length;i++){charCode=str.charCodeAt(i);if(charCode>=0&&charCode<=128){temLength+=1}else{realLength+=1}if(temLength==2){realLength+=1;temLength=0}}if(temLength==0){return realLength}else{return realLength+0.5}},checkIE:function(){var DEFAULT_VERSION="8.0";var ua=navigator.userAgent.toLowerCase();var isIE=ua.indexOf("msie")>-1;var safariVersion;if(isIE){safariVersion=ua.match(/msie ([\d.]+)/)[1];if(parseInt(safariVersion)<=parseInt(DEFAULT_VERSION)){return true}else{return false}}else{return false}},checkIsIE:function(){if(!!window.ActiveXObject||"ActiveXObject"in window)return true;else return false},check:function(time,checkname){var itemspaceid=this.adObject.itemspaceid;var time_limit=time;var cookie_name;var time_expires=new Date();time_expires.setMinutes(time_expires.getMinutes()+this.options.time_expires);if(time){if(checkname){cookie_name='beans_visit_'+itemspaceid+checkname}else{cookie_name='beans_visit_'+itemspaceid}var cookie_visit=cookie(cookie_name)||"{}";cookie_visit=JSON.parse(cookie_visit);cookie_visit[itemspaceid]=cookie_visit[itemspaceid]||1;var ad_visit=cookie_visit[itemspaceid];cookie_visit[itemspaceid]++;cookie(cookie_name,JSON.stringify(cookie_visit),{"path":'/',"expires":time_expires});if(ad_visit<time_limit){return true}else{return false}}else{return false}},flashChecker:function(){var hasFlash=0;var flashVersion=0;if(document.all){var swf=new ActiveXObject('ShockwaveFlash.ShockwaveFlash');if(swf){hasFlash=1;VSwf=swf.GetVariable("$version");flashVersion=parseInt(VSwf.split(" ")[1].split(",")[0])}}else{if(navigator.plugins&&navigator.plugins.length>0){var swf=navigator.plugins["Shockwave Flash"];if(swf){hasFlash=1;var words=swf.description.split(" ");for(var i=0;i<words.length;++i){if(isNaN(parseInt(words[i])))continue;flashVersion=parseInt(words[i])}}}}return{f:hasFlash,v:flashVersion}},postAdplus:function(adobj){var self=this;var curUrl=adobj.resource.click;if(curUrl=="")return;var urlPatten=/clk/;var impPatten=/imp/;var matchResult=curUrl.match(urlPatten);if(adobj.resource.clkm){for(var i=0;i<adobj.resource.clkm.length;i++){if(!!adobj.resource.clkm[i].match(urlPatten)||!!adobj.resource.clkm[i].match(impPatten)&&adobj.resource.clkm[i].indexOf("?")==-1){stat.get(adobj.resource.clkm[i]+"?apid="+adobj.cont_id+"&impid="+adobj.impression_id)}else if(!!adobj.resource.clkm[i].match(urlPatten)||!!adobj.resource.clkm[i].match(impPatten)&&adobj.resource.clkm[i].indexOf("?")!=-1){stat.get(adobj.resource.clkm[i]+"&apid="+adobj.cont_id+"&impid="+adobj.impression_id)}else{stat.get(adobj.resource.clkm[i])}}}else if(adobj.clkm){for(var i=0;i<adobj.clkm[i].length;i++){if(!!adobj.clkm[i].match(urlPatten)||!!adobj.clkm[i].match(impPatten)&&adobj.clkm[i].indexOf("?")==-1){stat.get(adobj.clkm[i]+"?apid="+adobj.cont_id+"&impid="+adobj.impression_id)}else if(!!adobj.clkm[i].match(urlPatten)||!!adobj.clkm[i].match(impPatten)&&adobj.clkm[i].indexOf("?")!=-1){stat.get(adobj.clkm[i]+"&apid="+adobj.cont_id+"&impid="+adobj.impression_id)}else{stat.get(adobj.clkm[i])}}}if(!!matchResult){var newTab=window.open('about:blank');newTab.location.href=curUrl+"?apid="+adobj.cont_id+"&impid="+adobj.impression_id}else{var newTab=window.open('about:blank');newTab.location.href=curUrl}}};Common.prototype=CP;Common.create=function(_new_prot){var self=this;_new_prot=_new_prot||{};if("init"in _new_prot){var newForm=function(options){return self.call(this,options)};newForm.create=Common.create;newForm.prototype=$.extend({},this.prototype,_new_prot);return newForm}else{return(function(){window["console"]&&console["log"]&&console.log("The new form has no init function; It is not be allowed!")})}};return Common});